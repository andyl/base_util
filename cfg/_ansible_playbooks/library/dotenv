#!/usr/bin/env ruby

file    = ARGV[0]
dotfile = if File.exist?(file)
            File.read(file).split('=').last
          else
            raise("Needs dotfile (absolute path)")
          end

raise("Dotfile not found (#{dotfile})") unless File.exist?(dotfile)

require 'json'

env = {}

File.readlines(dotfile).each do |line|
  next unless line.include?("=")
  key, val = line.split('=')
  env[key.strip] = val.chomp.strip
end

puts JSON.dump({"ansible_facts" => env})
