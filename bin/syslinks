#!/usr/bin/env ruby

require 'rubygems'
require 'colored'

host = ENV['SYSNAME'].downcase

# MONIT
if File.exist?("/etc/monitrc")
  puts "> Monit ".ljust(50, '-').cyan
  puts "http://#{host}:8989"
end

# NGINX BASE
if File.exist?("/etc/nginx/nginx.conf") 
  puts "> NGINX BASE ".ljust(50, '-').cyan
  puts "http://#{host}"
end

# APPS
if Dir.exist?("/etc/nginx/conf.d")
  Dir.glob("/etc/nginx/conf.d/*.conf").each do |path|
    app = File.basename(path).split('.').first
    text = File.read(path)
    port = /\:([0-9][0-9][0-9][0-9])\;/.match(text)[1]
    vhosts = /server_name (.+)\;/.match(text)[1].split(' ')
    puts "> #{app} ".ljust(50, '-').cyan
    puts "direct access: ".yellow
    puts "http://#{host}:#{port}"
    puts "nginx access: ".yellow
    vhosts.each do |vhost|
      puts "http://#{vhost}"
    end
  end
end

